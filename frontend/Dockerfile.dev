ARG NODE_IMAGE=node:20-alpine
FROM ${NODE_IMAGE}

WORKDIR /app

# Copy manifests (support both pnpm and npm)
COPY package.json ./
COPY pnpm-lock.yaml* ./
COPY package-lock.json* ./

# Safer install: disable lifecycle scripts during install
RUN set -eux; \
  corepack enable; \
  if [ -f pnpm-lock.yaml ]; then \
    corepack prepare pnpm@9.0.0 --activate; \
    pnpm i --frozen-lockfile --ignore-scripts --prefer-offline; \
  elif [ -f package-lock.json ]; then \
    npm ci --ignore-scripts; \
  else \
    npm install --ignore-scripts; \
  fi

# Copy sources
COPY . .

# Dev server
EXPOSE 5173

CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0"]
